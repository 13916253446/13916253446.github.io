(window.webpackJsonp=window.webpackJsonp||[]).push([["Foods.syncLayout"],{"C/Ux":function(s,t,a){"use strict";a.r(t);var n=a("JFUb"),e=Object(n.a)(null,function(){var s=this;s.$createElement;s._self._c;return s._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("section",[a("h4",{attrs:{id:"li-jie-bu-ju-layout"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#li-jie-bu-ju-layout","aria-hidden":"true"}},[s._v("¶")]),s._v(" 理解布局"),a("code",{pre:!0},[s._v("Layout")])]),s._v(" "),a("div",{staticClass:"tip"},[a("p",[s._v("布局是浏览器计算各元素几何信息的过程：元素的大小以及在页面中的位置。")])]),s._v(" "),a("p",[a("code",{pre:!0},[s._v("Layout")]),s._v("的开销主要体现在：")]),s._v(" "),a("ol",[a("li",[s._v("需要布局的元素数量")]),s._v(" "),a("li",[s._v("这些布局的复杂性")])]),s._v(" "),a("p",[s._v("当您更改样式时，浏览器会检查任何更改是否需要计算布局，以及是否需要更新渲染树。对“几何属性”（如宽度、高度、左侧或顶部）的更改都需要布局计算。")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-css"}},[a("span",{attrs:{class:"hljs-selector-class"}},[s._v(".box")]),s._v(" {\n  "),a("span",{attrs:{class:"hljs-attribute"}},[s._v("width")]),s._v(": "),a("span",{attrs:{class:"hljs-number"}},[s._v("20px")]),s._v(";\n  "),a("span",{attrs:{class:"hljs-attribute"}},[s._v("height")]),s._v(": "),a("span",{attrs:{class:"hljs-number"}},[s._v("20px")]),s._v(";\n}\n\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("/**\n * Changing width and height\n * triggers layout.\n */")]),s._v("\n"),a("span",{attrs:{class:"hljs-selector-class"}},[s._v(".box--expanded")]),s._v(" {\n  "),a("span",{attrs:{class:"hljs-attribute"}},[s._v("width")]),s._v(": "),a("span",{attrs:{class:"hljs-number"}},[s._v("200px")]),s._v(";\n  "),a("span",{attrs:{class:"hljs-attribute"}},[s._v("height")]),s._v(": "),a("span",{attrs:{class:"hljs-number"}},[s._v("350px")]),s._v(";\n}\n")])]),s._v(" "),a("p",[s._v("通过"),a("code",{pre:!0},[s._v("Performance")]),s._v("查看"),a("code",{pre:!0},[s._v("Layout")]),s._v("的影响范围以及时间")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://mp1.oss-cn-beijing.aliyuncs.com/blog/Layout.png",alt:"layout"}})]),s._v(" "),a("h4",{attrs:{id:"shi-me-shi-qiang-zhi-tong-bu-bu-ju"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shi-me-shi-qiang-zhi-tong-bu-bu-ju","aria-hidden":"true"}},[s._v("¶")]),s._v(" 什么是强制同步布局")]),s._v(" "),a("p",[s._v("渲染一帧的正常顺序应该是：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://mp1.oss-cn-beijing.aliyuncs.com/blog/frame.jpg",alt:"frame"}})]),s._v(" "),a("div",{staticClass:"tip"},[a("p",[s._v("在"),a("code",{pre:!0},[s._v("javascript")]),s._v("运行时，来至上一帧的所有布局值，都是已知的，所以在当前帧里面获取布局值是最好的做法(因为浏览器的优化可能把批量的操作统一化异步布局了，下一帧读取上一帧的布局肯定是能读到的)")])]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-javascript"}},[a("span",{attrs:{class:"hljs-comment"}},[s._v("// requestAnimationFrame运行于当前帧的最前面")]),s._v("\nrequestAnimationFrame(logBoxHeight);\n\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 获取布局的最优做法")]),s._v("\n"),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"hljs-title"}},[s._v("logBoxHeight")]),s._v("("),a("span",{attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(box.offsetHeight);\n}\n")])]),s._v(" "),a("div",{staticClass:"warning"},[a("p",[s._v("但是如果在当前帧的开始又更改样式，而且又需要读取这个样式，就会引发"),a("strong",[s._v("强制同步布局")]),s._v("(为了读取到正确的样式，JavaScript 强制浏览器提前执行布局)")])]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-javascript"}},[s._v("requestAnimationFrame(logBoxHeight);\n\n"),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"hljs-title"}},[s._v("logBoxHeight")]),s._v("("),a("span",{attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n  box.classList.add("),a("span",{attrs:{class:"hljs-string"}},[s._v("'super-big'")]),s._v(");\n  "),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 为了得到正确的样式，不得不立马应用上一步的样式，触发布局")]),s._v("\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(box.offsetHeight);\n}\n")])]),s._v(" "),a("div",{staticClass:"tip"},[a("p",[s._v("大部分情况下，并不需要应用样式然后查询值；使用上一帧的值就足够了。与浏览器同步（或比其提前）运行样式计算和布局可能成为瓶颈")])]),s._v(" "),a("p",[s._v("正确的做法：")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-javascript"}},[s._v("requestAnimationFrame(logBoxHeight);\n\n"),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"hljs-title"}},[s._v("logBoxHeight")]),s._v("("),a("span",{attrs:{class:"hljs-params"}}),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 上一帧的值")]),s._v("\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(box.offsetHeight);\n  "),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 当前帧运行到Layout的时候，正好渲染")]),s._v("\n  box.classList.add("),a("span",{attrs:{class:"hljs-string"}},[s._v("'super-big'")]),s._v(");\n}\n\n")])]),s._v(" "),a("h3",{attrs:{id:"can-kao"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#can-kao","aria-hidden":"true"}},[s._v("¶")]),s._v(" 参考：")]),s._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://developers.google.com/web/fundamentals/performance/rendering/avoid-large-complex-layouts-and-layout-thrashing?hl=zh-cn#avoid-forced-synchronous-layouts"}},[s._v("避免大型、复杂的布局和布局抖动")])])]),s._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://github.com/fi3ework/blog/issues/9"}},[s._v("前端性能优化之浏览器渲染优化 —— 打造60FPS页面")])])])])])}],!1,null,null,null);t.default=e.exports},Fg8s:function(s,t,a){var n=a("V8iq");"string"==typeof n&&(n=[[s.i,n,""]]),n.locals&&(s.exports=n.locals);(0,a("SZ7m").default)("5eec75b6",n,!0,{})},NMIB:function(s,t,a){"use strict";a.r(t);var n=a("XaI2"),e={name:"FoodsSyncLayout",components:{md:a.n(n).a}},l=a("JFUb");var r=function(s){a("Fg8s")},i=Object(l.a)(e,function(){var s=this.$createElement,t=this._self._c||s;return t("div",[t("md")],1)},[],!1,r,"data-v-59ce60e8",null);t.default=i.exports},V8iq:function(s,t,a){(s.exports=a("I1BE")(!1)).push([s.i,"",""])},XaI2:function(s,t,a){s.exports=a("C/Ux")}}]);