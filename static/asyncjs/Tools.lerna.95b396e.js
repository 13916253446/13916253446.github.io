(window.webpackJsonp=window.webpackJsonp||[]).push([["Tools.lerna"],{"1SUO":function(s,e,a){"use strict";a.r(e);var n=a("QhUf"),v={name:"ToolsLerna",components:{md:a.n(n).a}},t=a("JFUb");var r=function(s){a("Z3He")},_=Object(t.a)(v,function(){var s=this.$createElement,e=this._self._c||s;return e("div",[e("md")],1)},[],!1,r,"data-v-08eef956",null);e.default=_.exports},"1XE3":function(s,e,a){"use strict";a.r(e);var n=a("JFUb"),v=Object(n.a)(null,function(){var s=this;s.$createElement;s._self._c;return s._m(0)},[function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("section",[a("h1",[s._v("初始化项目")]),s._v(" "),a("p",[s._v("为了避免"),a("code",{pre:!0},[s._v("lerna")]),s._v("版本不一致，所以讲"),a("code",{pre:!0},[s._v("lerna")]),s._v("安装为项目依赖，而不是全局安装")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[s._v("$ npx lerna init\n")])]),s._v(" "),a("p",[s._v("这将创建"),a("code",{pre:!0},[s._v("lerna.json")]),s._v("配置文件和"),a("code",{pre:!0},[s._v("packages")]),s._v("文件夹")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-javascript"}},[s._v("lerna-repo/\n  packages/\n  package.json\n  lerna.json\n")])]),s._v(" "),a("h1",[s._v("项目管理模式")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("集中模式（"),a("strong",[s._v("默认模式")]),s._v("）")]),s._v(" "),a("p",[s._v("模块发布新版本时，都会升级到"),a("code",{pre:!0},[s._v("leran.json")]),s._v("里编写的"),a("code",{pre:!0},[s._v("version")]),s._v("字段，这是"),a("a",{attrs:{href:"https://github.com/babel/babel"}},[s._v("Babel")]),s._v("目前使用的模式。如果要自动将所有包版本绑定在一起，请使用此选项。这种方法的问题是任何包中的重大更改都将导致所有包具有新的主要版本")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[s._v("lerna init\n")])]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-json"}},[s._v("{\n  "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"packages"')]),s._v(": [\n    "),a("span",{attrs:{class:"hljs-string"}},[s._v('"packages/*"')]),s._v("\n  ],\n  "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"version"')]),s._v(": "),a("span",{attrs:{class:"hljs-string"}},[s._v('"0.0.0"')]),s._v("\n}\n")])])]),s._v(" "),a("li",[a("p",[s._v("独立模式")]),s._v(" "),a("p",[s._v("模块发布新版本时，会逐个询问需要升级的版本号，基准版本为它自身的"),a("code",{pre:!0},[s._v("package.json")]),s._v("，如果需要各个组件维护自身的版本号，那么就使用"),a("code",{pre:!0},[s._v("independent")]),s._v("模式，只需要去配置"),a("code",{pre:!0},[s._v("leran.json")]),s._v("即可。")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[s._v("lerna init --independent\n")])]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-json"}},[s._v("{\n  "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"packages"')]),s._v(": [\n    "),a("span",{attrs:{class:"hljs-string"}},[s._v('"packages/*"')]),s._v("\n  ],\n  "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"version"')]),s._v(": "),a("span",{attrs:{class:"hljs-string"}},[s._v('"independent"')]),s._v("\n} \n")])])])]),s._v(" "),a("h1",[s._v("lerna.json")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-json"}},[s._v("{\n  "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"version"')]),s._v(": "),a("span",{attrs:{class:"hljs-string"}},[s._v('"1.1.3"')]),s._v(",\n  "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"npmClient"')]),s._v(": "),a("span",{attrs:{class:"hljs-string"}},[s._v('"npm"')]),s._v(",\n  "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"command"')]),s._v(": {\n    "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"publish"')]),s._v(": {\n      "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"ignoreChanges"')]),s._v(": ["),a("span",{attrs:{class:"hljs-string"}},[s._v('"ignored-file"')]),s._v(", "),a("span",{attrs:{class:"hljs-string"}},[s._v('"*.md"')]),s._v("]\n    },\n    "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"bootstrap"')]),s._v(": {\n      "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"ignore"')]),s._v(": "),a("span",{attrs:{class:"hljs-string"}},[s._v('"component-*"')]),s._v(",\n      "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"npmClientArgs"')]),s._v(": ["),a("span",{attrs:{class:"hljs-string"}},[s._v('"--no-package-lock"')]),s._v("]\n    }\n  },\n  "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"packages"')]),s._v(": ["),a("span",{attrs:{class:"hljs-string"}},[s._v('"packages/*"')]),s._v("]\n}\n")])]),s._v(" "),a("ul",[a("li",[a("p",[a("code",{pre:!0},[s._v("version")]),s._v("：存储库的当前版本。")])]),s._v(" "),a("li",[a("p",[a("code",{pre:!0},[s._v("npmClient")]),s._v("：指定运行命令的特定客户端的选项（也可以基于每个命令指定）。也可是是"),a("code",{pre:!0},[s._v("yarn")]),s._v("使用"),a("code",{pre:!0},[s._v("yarn")]),s._v("运行所有命令。默认为"),a("code",{pre:!0},[s._v("npm")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",{pre:!0},[s._v("command.publish.ignoreChanges")]),s._v("："),a("code",{pre:!0},[s._v("lernam publish")]),s._v("会检查"),a("code",{pre:!0},[s._v("packages")]),s._v("目录下哪些包的文件有更新，这个配置可以忽略某些文件的修改避免发布新版本。例如：修复"),a("code",{pre:!0},[s._v("README.md")]),s._v("拼写错误")])]),s._v(" "),a("li",[a("p",[a("code",{pre:!0},[s._v("command.bootstrap.ignore")]),s._v("：忽略执行"),a("code",{pre:!0},[s._v("lerna bootstrap")]),s._v("命令时候安装的一些包")])]),s._v(" "),a("li",[a("p",[a("code",{pre:!0},[s._v("command.bootstrap.npmClientArgs")]),s._v("：字符串数组,直接传递给"),a("code",{pre:!0},[s._v("npm install")]),s._v(",作为参数. 在"),a("code",{pre:!0},[s._v("lerna bootstrap")]),s._v("命令期间")])]),s._v(" "),a("li",[a("p",[a("code",{pre:!0},[s._v("command.bootstrap.scope")]),s._v("：一组匹配模式,限制运行时安装哪些包,在"),a("code",{pre:!0},[s._v("lerna bootstrap")]),s._v("命令期间。")])]),s._v(" "),a("li",[a("p",[a("code",{pre:!0},[s._v("packages")]),s._v("：指定项目包")]),s._v(" "),a("p",[s._v("默认项目都在"),a("strong",[s._v("packages")]),s._v("目录下，你也可以把项目包放在别的目录，然后重新定义"),a("code",{pre:!0},[s._v("packages")]),s._v("字段")])])]),s._v(" "),a("h1",[s._v("lerna add")]),s._v(" "),a("p",[s._v("安装资源包到项目依赖")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[s._v("$ lerna add [@version] [--dev] [--exact]\n")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("安装资源包到所有项目")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[a("span",{attrs:{class:"hljs-comment"}},[s._v("# 安装到dependencies")]),s._v("\nlerna add webpack\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("# 安装到devDependencies")]),s._v("\nlerna add --dev webpack\n")])])]),s._v(" "),a("li",[a("p",[s._v("安装资源包到指定项目")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[a("span",{attrs:{class:"hljs-comment"}},[s._v("# 安装webpack资源包到utils项目")]),s._v("\nlerna add webpack --scope=utils\n")])])]),s._v(" "),a("li",[a("p",[s._v("安装资源包到指定规则的项目里面")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[a("span",{attrs:{class:"hljs-comment"}},[s._v("# 安装webpack资源包到前缀是test的项目里")]),s._v("\nlerna add webpack packages/test*\n")])])])]),s._v(" "),a("h1",[s._v("lerna bootstrap")]),s._v(" "),a("p",[s._v("将本地存在相互依赖的包链接在一起，然后安装剩余依赖的包")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[s._v("lerna bootstrap\n")])]),s._v(" "),a("p",[s._v("运行时此命令将：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在所有的项目下执行"),a("code",{pre:!0},[s._v("npm install")]),s._v("安装所有的资源包")])]),s._v(" "),a("li",[a("p",[s._v("链接"),a("code",{pre:!0},[s._v("npm link")]),s._v("当前目录下所有的项目")])]),s._v(" "),a("li",[a("p",[s._v("执行已经安装资源包的项目"),a("code",{pre:!0},[s._v("npm run prepublish")])])]),s._v(" "),a("li",[a("p",[s._v("执行已经安装资源包的项目"),a("code",{pre:!0},[s._v("npm run prepare")])])])]),s._v(" "),a("h1",[s._v("lerna version")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[a("span",{attrs:{class:"hljs-comment"}},[s._v("# 自定义版本")]),s._v("\nlerna version "),a("span",{attrs:{class:"hljs-number"}},[s._v("1.0")]),s._v("."),a("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v("\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("# 选择一种模式生成版本（patch是在原来的版本基础上加0.0.1）")]),s._v("\nlerna version patch\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("# 通过命令行选择来确定版本")]),s._v("\nlerna version\n")])]),s._v(" "),a("p",[a("img",{attrs:{src:"http://mp1.oss-cn-beijing.aliyuncs.com/blog/screely-1545557968431.png",alt:""}}),a("img",{attrs:{src:"http://mp1.oss-cn-beijing.aliyuncs.com/blog/screely-1545557968431.png",alt:""}})]),s._v(" "),a("p",[s._v("执行此命令，将执行以下操作")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("标记上一个版本以来已更新的包")]),s._v(" "),a("p",[s._v("每个项目"),a("code",{pre:!0},[s._v("package.json")]),s._v("下面有一个"),a("code",{pre:!0},[s._v("gitHead")]),s._v("标识（这个字段的值是从git暂存区取得，所以每次代码都要"),a("strong",[s._v("git commit")]),s._v("之后才有效，否则就会报没有资源包需要更新版本）")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-json"}},[s._v("{\n    "),a("span",{attrs:{class:"hljs-attr"}},[s._v('"gitHead"')]),s._v(": "),a("span",{attrs:{class:"hljs-string"}},[s._v('"46a570ebbd8e34766edd9fb8f4fad9288c7bcf30"')]),s._v("\n}\n")])])]),s._v(" "),a("li",[a("p",[s._v("提示以及选择版本号")])]),s._v(" "),a("li",[a("p",[s._v("修改项目的版本("),a("code",{pre:!0},[s._v("version")]),s._v(")以及其它元数据比如"),a("code",{pre:!0},[s._v("gitHead")])])]),s._v(" "),a("li",[a("p",[s._v("提交("),a("code",{pre:!0},[s._v("git commit")]),s._v(")这些更改")])]),s._v(" "),a("li",[a("p",[s._v("推送到"),a("code",{pre:!0},[s._v("git")]),s._v("远程服务器")])])]),s._v(" "),a("h3",{attrs:{id:"options"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#options","aria-hidden":"true"}},[s._v("¶")]),s._v(" options")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("--amend")]),s._v(" "),a("p",[s._v("使用此标记运行时，将跳过"),a("code",{pre:!0},[s._v("git push")]),s._v("并保留当前提交的更改，而不是新增一个修改("),a("strong",[s._v("没有此标记时会提交一个新的commit信息然后推送到远程服务器")]),s._v(")")]),s._v(" "),a("h1"),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[s._v("lerna version --amend\n")])])]),s._v(" "),a("li",[a("p",[s._v("--commit-hooks")]),s._v(" "),a("p",[s._v("提交版本更改时是否执行git钩子("),a("strong",[s._v("git commit hooks")]),s._v(")，默认是"),a("strong",[s._v("true")]),s._v("，可以通过"),a("code",{pre:!0},[s._v("--no-commit-hooks")]),s._v("禁用")]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[s._v("lerna version\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("# 禁用git钩子")]),s._v("\nlerna version --no-commit-hooks\n")])])]),s._v(" "),a("li",[a("p",[s._v("--conventional-commits")]),s._v(" "),a("p",[s._v("提交版本的时候，直接确定版本不用选择版本("),a("strong",[s._v("加0.1")]),s._v(")，并生成"),a("code",{pre:!0},[s._v("CHANGELOG")])]),s._v(" "),a("pre",{pre:!0},[a("code",{attrs:{class:"hljs language-powershell"}},[s._v("lerna version --conventional-commits\n")])])])])])}],!1,null,null,null);e.default=v.exports},G9xt:function(s,e,a){(s.exports=a("I1BE")(!1)).push([s.i,"",""])},QhUf:function(s,e,a){s.exports=a("1XE3")},Z3He:function(s,e,a){var n=a("G9xt");"string"==typeof n&&(n=[[s.i,n,""]]),n.locals&&(s.exports=n.locals);(0,a("SZ7m").default)("223723e0",n,!0,{})}}]);