(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{"1ZdG":function(e,a,n){"use strict";n.r(a);var t=n("JFUb"),v=Object(t.a)(null,function(){var e=this;e.$createElement;e._self._c;return e._m(0)},[function(){var e=this,a=e.$createElement,n=e._self._c||a;return n("section",[n("h3",{attrs:{id:"shou-xian-zhang-wo-ji-dian-gai-nian"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#shou-xian-zhang-wo-ji-dian-gai-nian","aria-hidden":"true"}},[e._v("¶")]),e._v(" 首先掌握几点概念")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("1、项目依赖的模块，这些模块开发环境的依赖("),n("code",{pre:!0},[e._v("dependencies")]),e._v(")，都会安装到"),n("code",{pre:!0},[e._v("node_modules")]),e._v("下面，只不过安装的位置层级不一定。")])])]),e._v(" "),n("img",{staticStyle:{height:"500px"},attrs:{src:"https://mp1.oss-cn-beijing.aliyuncs.com/blog/npm1.png"}}),e._v(" "),n("ul",[n("li",[n("strong",[e._v("2、项目模块的依赖也会根据语义化版本("),n("code",{pre:!0},[e._v("SemVer")]),e._v(")自动安装最新版本的包，")])])]),e._v(" "),n("img",{staticStyle:{height:"500px"},attrs:{src:"https://mp1.oss-cn-beijing.aliyuncs.com/blog/npm2.png"}}),e._v(" "),n("ul",[n("li",[n("strong",[e._v("3、所以npm包开发环境依赖的包一定要谨慎对待，如果第三方包的维护者，不遵守"),n("code",{pre:!0},[e._v("SemVer")]),e._v("语义化版本，发布了小版本不能往下兼容的情况，就会引发问题。")])])]),e._v(" "),n("div",{staticClass:"warning"},[n("p",[e._v("npm包通过"),n("code",{pre:!0},[e._v("package-lock.json")]),e._v("是不能锁定版本，只能通过"),n("code",{pre:!0},[e._v("package.json")]),e._v("指定固定版本来锁定。"),n("br")])]),e._v(" "),n("p",[n("strong",[e._v("锁定版本的"),n("code",{pre:!0},[e._v("package.json")])])]),e._v(" "),n("pre",{pre:!0},[n("code",{attrs:{class:"hljs language-json"}},[e._v("{\n  "),n("span",{attrs:{class:"hljs-attr"}},[e._v('"dependencies"')]),e._v(": {\n    "),n("span",{attrs:{class:"hljs-attr"}},[e._v('"vue"')]),e._v(": "),n("span",{attrs:{class:"hljs-string"}},[e._v('"2.5.10"')]),e._v("\n  }\n}\n")])]),e._v(" "),n("h3",{attrs:{id:"yi-lai-shu-de-luo-ji-jie-gou-yu-wu-li-jie-gou"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#yi-lai-shu-de-luo-ji-jie-gou-yu-wu-li-jie-gou","aria-hidden":"true"}},[e._v("¶")]),e._v(" 依赖树的逻辑结构与物理结构")]),e._v(" "),n("p",[e._v("逻辑结构：就是每个依赖项下面依赖资源都是以层级的形式嵌套在各自的模块"),n("code",{pre:!0},[e._v("node_modules")]),e._v("下面。")]),e._v(" "),n("p",[e._v("物理结构：就是安装的时候，实际上各个资源在项目"),n("code",{pre:!0},[e._v("node_modules")]),e._v("下层级情况。")]),e._v(" "),n("p",[n("strong",[e._v("可以使用命令查看项目的层级结构")])]),e._v(" "),n("p",[n("code",{pre:!0},[e._v("tree -d")]),e._v("命令以树状图的方式列出一个项目下所有依赖的物理结构")]),e._v(" "),n("p",[n("code",{pre:!0},[e._v("npm ls")]),e._v("命令以树状图的方式列出一个项目下所有依赖的逻辑结构")]),e._v(" "),n("div",{staticClass:"tip"},[n("p",[e._v("可以使用控制台重定向功能("),n("code",{pre:!0},[e._v(">")]),e._v(")将控制台的内容，输出到文件中。"),n("br"),e._v(" "),n("code",{pre:!0},[e._v("tree -d > tree.md")])])]),e._v(" "),n("h3",{attrs:{id:"npm2-xia-de-mo-kuai-an-zhuang-ji-zhi"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm2-xia-de-mo-kuai-an-zhuang-ji-zhi","aria-hidden":"true"}},[e._v("¶")]),e._v(" npm2下的模块安装机制")]),e._v(" "),n("p",[n("code",{pre:!0},[e._v("npm2")]),e._v("安装多级的依赖模块采用嵌套的安装方式：")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mp1.oss-cn-beijing.aliyuncs.com/blog/npm3.png",alt:"npm"}})]),e._v(" "),n("div",{staticClass:"tip"},[n("p",[e._v("优点：实现多版本兼容 "),n("br"),e._v("\n缺点：造成相同模块大量冗余的问题")])]),e._v(" "),n("p",[n("strong",[e._v("依赖包的依赖包相同，这就造成了大量代码冗余")])]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mp1.oss-cn-beijing.aliyuncs.com/blog/npm4.png",alt:"npm"}})]),e._v(" "),n("h3",{attrs:{id:"npm3-xia-de-mo-kuai-an-zhuang-ji-zhi"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm3-xia-de-mo-kuai-an-zhuang-ji-zhi","aria-hidden":"true"}},[e._v("¶")]),e._v(" npm3下的模块安装机制")]),e._v(" "),n("p",[n("code",{pre:!0},[e._v("npm3")]),e._v("和"),n("code",{pre:!0},[e._v("npm2")]),e._v("的不同主要体现在二级模块的安装上：")]),e._v(" "),n("p",[n("code",{pre:!0},[e._v("npm3")]),e._v('会"尽量"把逻辑上某个层级的模块在物理结构上"全部"放在项目的第一层级里，具体我概括为以下三种情况：')]),e._v(" "),n("div",{staticClass:"tip"},[n("p",[e._v("1、在安装某个二级模块时，若发现第一层级还没有相同名称的模块，便把这第二层级的模块放在第一层级")])]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mp1.oss-cn-beijing.aliyuncs.com/blog/npm5.png",alt:"npm"}})]),e._v(" "),n("div",{staticClass:"tip"},[n("p",[e._v("2、在安装某个二级模块时，若发现第一层级有相同名称，相同版本的模块，便直接复用那个模块。")])]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mp1.oss-cn-beijing.aliyuncs.com/blog/npm6.png",alt:"npm"}})]),e._v(" "),n("p",[e._v("对"),n("code",{pre:!0},[e._v("npm2")]),e._v(",两个C包是相同的，造成模块冗余")]),e._v(" "),n("p",[e._v("在"),n("code",{pre:!0},[e._v("npm3")]),e._v("中，因为A模块下的C模块被安装到了第一级，这使得B模块能够复用处在同一级下；且名称，版本，均相同的C模块")]),e._v(" "),n("p",[n("code",{pre:!0},[e._v("npm3")]),e._v("就是用这种方式，部分地解决了"),n("code",{pre:!0},[e._v("npm2")]),e._v("的痛点（部分）")]),e._v(" "),n("div",{staticClass:"tip"},[n("p",[e._v("3、在安装某个二级模块时，若发现第一层级有相同名称，但版本不同的模块，便只能嵌套在自身的父模块下方")])]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mp1.oss-cn-beijing.aliyuncs.com/blog/npm7.png",alt:"npm"}})]),e._v(" "),n("p",[e._v("在"),n("code",{pre:!0},[e._v("npm3")]),e._v("中，因为"),n("code",{pre:!0},[e._v("B")]),e._v("和"),n("code",{pre:!0},[e._v("A")]),e._v("所要求的依赖模块不同，（"),n("code",{pre:!0},[e._v("B")]),e._v("下要求是"),n("code",{pre:!0},[e._v("v1.0")]),e._v("的"),n("code",{pre:!0},[e._v("C")]),e._v("，"),n("code",{pre:!0},[e._v("A")]),e._v("下要求是"),n("code",{pre:!0},[e._v("v2.0")]),e._v("的"),n("code",{pre:!0},[e._v("C")]),e._v(" ）所以"),n("code",{pre:!0},[e._v("B")]),e._v("不能像2中那样复用"),n("code",{pre:!0},[e._v("A")]),e._v("下的"),n("code",{pre:!0},[e._v("C v1.0")]),e._v("模块")]),e._v(" "),n("h3",{attrs:{id:"npm3-xia-rong-yu-qing-kuang"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm3-xia-rong-yu-qing-kuang","aria-hidden":"true"}},[e._v("¶")]),e._v(" npm3下冗余情况")]),e._v(" "),n("div",{staticClass:"warning"},[n("p",[e._v("实际上："),n("code",{pre:!0},[e._v("npm3")]),e._v("中仍然可能出现模块冗余的情况，因为一级目录下已经有"),n("code",{pre:!0},[e._v("v1.0")]),e._v("的"),n("code",{pre:!0},[e._v("C")]),e._v("模块了，所以所有的"),n("code",{pre:!0},[e._v("v2.0")]),e._v("只能作为二级依赖模块被安装，这样你就会看到如下的情况")])]),e._v(" "),n("p",[n("img",{attrs:{src:"https://mp1.oss-cn-beijing.aliyuncs.com/blog/npm9.png",alt:"npm"}})]),e._v(" "),n("h3",{attrs:{id:"qu-chu-rong-yu-mo-kuai"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#qu-chu-rong-yu-mo-kuai","aria-hidden":"true"}},[e._v("¶")]),e._v(" 去除冗余模块")]),e._v(" "),n("p",[n("code",{pre:!0},[e._v("npm dedupe")]),e._v("尽量压平依赖树，它能够把凡是能够去除的冗余的二级依赖模块，“重定向”到名称／版本相同的一级模块。")]),e._v(" "),n("div",{staticClass:"tip"},[n("p",[e._v("每次安装/卸载了包之后最好重新执行"),n("code",{pre:!0},[e._v("npm dedupe")]),e._v("，以保证包结构是最优的")])]),e._v(" "),n("h3",{attrs:{id:"can-kao"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#can-kao","aria-hidden":"true"}},[e._v("¶")]),e._v(" 参考：")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://www.cnblogs.com/penghuwan/p/6970543.html"}},[e._v("详解npm的模块安装机制")])])])])}],!1,null,null,null);a.default=v.exports},AZ5O:function(e,a,n){e.exports=n("1ZdG")},FTmu:function(e,a,n){"use strict";n.r(a);var t=n("AZ5O"),v={name:"NpmInstallDetail",components:{md:n.n(t).a}},s=n("JFUb");var _=function(e){n("z//v")},p=Object(s.a)(v,function(){var e=this.$createElement,a=this._self._c||e;return a("div",[a("md")],1)},[],!1,_,"data-v-668471d6",null);a.default=p.exports},gKCf:function(e,a,n){(e.exports=n("I1BE")(!1)).push([e.i,"",""])},"z//v":function(e,a,n){var t=n("gKCf");"string"==typeof t&&(t=[[e.i,t,""]]),t.locals&&(e.exports=t.locals);(0,n("SZ7m").default)("71f6b8dc",t,!0,{})}}]);